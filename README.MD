# ‚§π Projeto CRUD com Node.js, TypeScript e Express [üöÄ]

Este √© um projeto de CRUD para o INOVATEC. Ele inclui autentica√ß√£o com JWT, banco de dados PostgreSQL e arquitetura organizada com controllers, middlewares e services.

---

## Tecnologias utilizadas

- Node.js
- Jest
- TypeScript
- Express
- Sequelize
- PostgreSQL
- JWT
- Dotenv
- ts-node-dev

---

## ‚öôÔ∏è Instala√ß√£o

1. Clone o reposit√≥rio:

```bash
git clone https://github.com/seu-usuario/seu-projeto.git
cd seu-projeto
```

2. Instale as depend√™ncias:

```
npm install
```

3. Crie um arquivo .env baseado no .env.example

```
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASS=sua_senha
DB_NAME=seu_banco
JWT_SECRET=sua_chave_secreta
```

4. Rode o projeto

```
npm run dev
```

---

## Endpoints

| M√©todo     | Endpoint      | Descri√ß√£o                                                                   | Corpo da Requisi√ß√£o                                             | Resposta                                                  | Autentica√ß√£o Requerida |
| ---------- | ------------- | --------------------------------------------------------------------------- | --------------------------------------------------------------- | --------------------------------------------------------- | ---------------------- |
| **POST**   | `/auth/login` | Recebe email, valida se o usu√°rio existe e retorna um token JWT.            | `{"email": "exemplo@dominio.com", "name": "Nome do Usu√°rio"}`   | 200 OK (Token JWT) ou 401 Unauthorized (Erro)             | N√£o                    |
| **POST**   | `/users`      | Cria um novo usu√°rio com `name`, `email` e `age` (opcional).                | `{"name": "Nome", "email": "exemplo@dominio.com", "age": 25}`   | 201 Created (Usu√°rio criado) ou 400/500 (Erro)            | N√£o                    |
| **GET**    | `/users`      | Lista todos os usu√°rios.                                                    | N√£o aplic√°vel                                                   | 200 OK (Lista de usu√°rios)                                | Sim (Token v√°lido)     |
| **GET**    | `/users/:id`  | Busca um usu√°rio pelo `id`.                                                 | N√£o aplic√°vel                                                   | 200 OK (Usu√°rio) ou 404 Not Found (Erro)                  | Sim (Token v√°lido)     |
| **PUT**    | `/users/:id`  | Atualiza um usu√°rio pelo `id`, permitindo alterar `name`, `email` ou `age`. | `{"name": "Novo Nome", "email": "novo@dominio.com", "age": 30}` | 200 OK (Usu√°rio atualizado) ou 404 Not Found (Erro)       | Sim (Token v√°lido)     |
| **DELETE** | `/users/:id`  | Remove um usu√°rio pelo `id`.                                                | N√£o aplic√°vel                                                   | 204 No Content (Usu√°rio removido) ou 404 Not Found (Erro) | Sim (Token v√°lido)     |

---

## Rodando o projeto no insomnia

### üì• Importa√ß√£o do Workspace

Voc√™ pode testar todos os endpoints importando o arquivo `.txt` exportado do Insomnia:

1. Abra o Insomnia.
2. V√° em **Application** ‚Üí **Import Data** ‚Üí **From File**.
3. Selecione o arquivo exportado **arquivoInsomnia.txt**
4. O workspace com todas as requisi√ß√µes ser√° adicionado automaticamente.

### üîê Uso da vari√°vel `{{userTOKEN}}`

Para os endpoints que requerem autentica√ß√£o, o token JWT √© passado no header como vari√°vel:

```http
Authorization: Bearer {{userTOKEN}}
```

Ap√≥s fazer login usando o endpoint POST /auth/login, copie o token retornado e cole na vari√°vel usertoken:

Clique no topo da tela onde est√° escrito Environment.

Adicione ou edite a vari√°vel assim:

```
{
	"_BASEURL_": "http://localhost:3000/",
	"userTOKEN": "TOKEN"*
}
```

Com isso, voc√™ pode testar facilmente todos os endpoints autenticados e n√£o autenticados do seu projeto no Insomnia

---

## üß™ Testes Unit√°rios

O projeto utiliza o **Jest** na l√≥gica de testes unit√°rios

### ‚ñ∂Ô∏è Executando os testes

Para rodar os testes, basta usar o seguinte comando:

```
npm test
```

#### Exemplo de Teste

Aqui est√° um exemplo de um teste unit√°rio implementado para a rota `POST /users`:

```javascript
it("deve verificar se o e-mail j√° foi cadastrado", async () => {
  await request(app).post("/users").send({
    name: "Teste",
    email: "teste@exemplo.com",
  });

  const res = await request(app).post("/users").send({
    name: "Teste 2",
    email: "teste@exemplo.com",
  });

  expect(res.status).toBe(400);
  expect(res.body.error).toBe("Email j√° cadastrado");
});
```

Este teste tem como objetivo garantir que o sistema n√£o permita a cria√ß√£o de usu√°rios com e-mails duplicados. Aqui est√£o os detalhes:

- Primeiro, criamos um usu√°rio com o e-mail `teste@exemplo.com`.
- Em seguida, tentamos criar outro usu√°rio com o mesmo e-mail.
- Esperamos que o servidor retorne um erro `400 Bad Request`, juntamente com a mensagem `"Email j√° cadastrado"`, garantindo que a valida√ß√£o de e-mails duplicados esteja funcionando corretamente.
